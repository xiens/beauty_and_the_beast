<html lang="pl">
<head>
<meta charset="utf-8" />
<title>Beauty and Beast</title>
</head>
<script src="jquery-3.2.0.min.js"></script> 

<body>
<div id="container">
<h2>Filtrowanie i sortowanie</h2> 


<select  id="atrybut" name="atrybut" onchange="filtr()" >
  <option>id</option>
  <option>firstName</option>
  <option>lastName</option>
  <option>dateOfBirth</option>
  <option>function</option>
  <option>experience</option>
 </select>

&nbsp;
&nbsp;
<select  id="wybor" name="wybor" onchange="ile_na_stronie()"> </select>

&nbsp;
&nbsp;

<select id="wybor_sort" name="wybor_sort" > </select>

 <button type="button"  id="sort" name="sort" onclick="sort()" >Sortuj</button>


&nbsp;<div id="output">  </div>
&nbsp; 

<p id="demo"> strona nr 0 </p>
  <input type="button" value="poprzednia" onclick="strona--;wyswietl()">

  <input type="button" value="następna" onclick="strona++;wyswietl()">
</div>

<script>
    var strona=0;
    var ileNaStronie=5;
    var table =[];
    var text ='{"products": [' +
        '{"id":1, "firstName":"Dobromir","lastName":"Sprytny","dateOfBirth":"1.7.1990 11:35","function":"kamerdyner","experience":4},' +
        '{"id":4,"firstName":"Helga","lastName":"Uczynna","dateOfBirth":"4.02.1976 14:37","function":"pokojowka","experience":12},'+
        '{"id":2,"firstName":"Marianna","lastName":"Prostota","dateOfBirth":"28.10.1976 2:15","function":"pokojówka","experience":12},'+
        '{"id":3,"firstName":"Walerian","lastName":"Szybki","dateOfBirth":"03.01.1986 23:10","function":"kamerdyner","experience":10},'+
        '{"id":5,"firstName":"Krzysztof","lastName":"Klucznik","dateOfBirth":"10.10.1986 18:00","function":"lokaj","experience":3},'+
        '{"id":6,"firstName":"Konstancja","lastName":"Urodziwa","dateOfBirth":"29.02.1936 13:33","function":"kucharka","experience":8},'+
        '{"id":7,"firstName":"Kornelia","lastName":"Wstydliwa","dateOfBirth":"19.02.1973 23:55","function":"pokojówka","experience":8},'+
        '{"id":8,"firstName":"Władysława","lastName":"Dobrotliwa","dateOfBirth":"29.12.1977 18:25","function":"pokojówka","experience":8},'+
        '{"id":9,"firstName":"Mirosław","lastName":"Podstępny","dateOfBirth":"09.12.1972 17:35","function":"kamerdyner","experience":8},'+
        '{"id":10,"firstName":"Walerian","lastName":"Drażliwy","dateOfBirth":"29.03.1980 15:36","function":"lokaj","experience":8},'+
        '{"id":11,"firstName":"Katarzyna","lastName":"Krasna","dateOfBirth":"05.05.1983 01:15","function":"pokojówka","experience":8},'+
        '{"id":12,"firstName":"Urszula","lastName":"Markotna","dateOfBirth":"06.04.1981 12:35","function":"pokojówka","experience":8} ]}';


    var obj =JSON.parse(text);


function filtr()
{


var nr_atrybutu = document.getElementById("atrybut").selectedIndex; 

var x = document.getElementById("wybor"); //x - to co pod danym atrybutem, bedzie dopisywane do listy
    //zerowanie
    for(i=x.options.length-1;i>=0;i--)
    {
        x.remove(i);
    }
	
	for (var k=0;k<12;k++)
	{
		var option = document.createElement("option");
		switch(nr_atrybutu)
		{
		case 0:
			option.text = obj.products[k].id ;
			break;
		case 1:
			option.text = obj.products[k].firstName ;
			break;
		case 2:
			option.text = obj.products[k].lastName ;
			break;
		case 3:
			option.text = obj.products[k].dateOfBirth ;
			break;
		case 4:
			option.text = obj.products[k].function ;
			break;
		case 5:
			option.text = obj.products[k].experience ;
			break;
		}
		x.add(option,x[k]);
	}

}


 function sort() {

//funkcja dodaje elementy z jednego selekta do tablicy, nastepnie sortuje je

     var wybor = document.getElementById("wybor");
     var wybor_sort = document.getElementById("wybor_sort");
     var option1;
     var od = document.getElementById("atrybut").selectedIndex;
     var table2 = [];

//uswanie poprzednich wartosci z selecta wybor_sort
     for (i = wybor_sort.options.length - 1; i >= 0; i--)
         wybor_sort.remove(i);

     for (var i = 0; i < (wybor.length); i++) {
         if ((od == 0) || (od == 5))
             table[i] = parseInt(wybor.options[i].text);//dodaje do tablicy tekst zamieniony na liczby
         else if (od == 3)
         {
             var data=obj.products[i].dateOfBirth;

             var data_new= "";

             var pozycja = data.indexOf(' ');
             data_new=data.substring(0, pozycja);
             var czas=data.substring(pozycja,data.length);

             var data_czesci = data_new.split('.');
             data_new=data_czesci[2]+"-"+data_czesci[1]+"-"+data_czesci[0]+czas;

             table[i]=new Date(data_new).getTime(); //zamiana na liczbe, zeby dalo sie posortowac
         }

         else
             table[i] = wybor.options[i].text; //dodaje do tablicy tekst z selecta wybor
     }

//sortowanie przez wstawianie
     var j = 0;
     var min_element = table[0];
     for (var i = 1; i < wybor.length; i++) {
         min_element = table[i];
         j = i - 1;
         while ((j >= 0) && (min_element < table[j])) {
             table[j + 1] = table[j];
             j = j - 1;
         }
         table[j + 1] = min_element;
     }
     //zamiana z powrotem na date
if(od==3) {
         for(var i=0;i<12;i++)
    table[i]=new Date(table[i]).toUTCString();
}
  //dodawanie posortowanej tablicy do selekta wybor_sort
     for(i=0;i<12;i++)
     {
         option1 = document.createElement("option"); //tworzy w petli za kazdym razem nowa opcje
         option1.text = table[i]; //pod stworzona opcje dopisuje element tablicy
         wybor_sort.add(option1,(wybor_sort[i])); //dodaje element do listy
     }

     wyswietl();

 }
//funkcja do wyswietlania okreslonej liczby elementow na stronie (paginacja)
function wyswietl()
{
    var tekst="";
//zabezpieczenie przed przekroczeniem numeru strony
    if (strona<0) strona++;
    if (strona>table.length/ileNaStronie) strona--;
    for (var i=0;i<ileNaStronie;i++)
    {
        var element=i+strona*ileNaStronie;
        if (element<table.length) //zabezp. przed przekroczeniem indeksu tablicy
        {
            tekst+=table[element]+"<BR>";
            document.getElementById('output').innerHTML=tekst;
        }
    }
    document.getElementById('demo').innerHTML="strona nr: " +strona;
}

</script>


</body>
</html>